<html lang="pt-br">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>TCC - Kássia</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.1/mdb.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
</head>

<body>
    <div class="container">
        <div class="row mt-5">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Caminho Critico</h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">A CALCULAR</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Prazo Total</h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">A CALCULAR</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Adicionar Tarefa</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group mb-3">
                                    <div class="form-outline">
                                        <input type="text" id="nomeTarefa" class="form-control form-control-lg" />
                                        <label class="form-label" for="nomeTarefa">Tarefa</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="input-group mb-3">
                                    <div class="form-outline">
                                        <input type="number" id="tempoTarefa" min="0"
                                            class="form-control form-control-lg" />
                                        <label class="form-label" for="tempoTarefa">Tempo de Entrega (dias)</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="input-group mb-3">
                                    <div class="form-outline">
                                        <input type="text" id="tarefasDependentes"
                                            class="form-control form-control-lg" />
                                        <label class="form-label" for="tarefasDependentes">Dependentes</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-1">
                                <button type="button" class="btn btn-primary btn-lg btn-floating"
                                    onclick="CadastrarTarefa()" style="background-color: #7C4DFF;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Tarefas</h5>
                    </div>
                    <div class="card-body">
                        <table class="table align-middle mb-0 bg-white" id="tabelaTarefas">
                            <thead class="bg-light">
                                <tr>
                                    <th>Código</th>
                                    <th>Descrição Tarefa</th>
                                    <th>Tempo de Entrega</th>
                                    <th>Tarefa Dependente</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                        </table>
                        <div class="mt-3">
                            <button type="button" class="btn btn-primary btn-lg float-end"
                                style="background-color: #7C4DFF;">Calcular Tarefas</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MDB -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.1/mdb.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>

    <style>
        html,
        body {
            background: #9C27B0;
        }
    </style>
    <script>
        var codigo = 0;
        var table;
        $(document).ready(function () {
            table = $('#tabelaTarefas').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.1/i18n/pt-BR.json'
                }
            });

            $('#tabelaTarefas tbody').on('click', 'button', function () {
                var conteudoLinha = table.row($(this).parents('tr')).data();
                var codigoTarefa = conteudoLinha[0];
                var isDependente = VerificarDependentes(codigoTarefa);

                if (isDependente) {
                    alert("Não e possível excluir uma tarefa que possui dependentes.");
                } else {
                    table.row($(this).parents('tr')).remove().draw();
                }
            });
        });

        function CadastrarTarefa() {
            var novoCodigoTarefa = codigo + 1;

            //verificar se existe as tarefas se tiver dependentes
            if ($("#tarefasDependentes").val() != "") {
                var isTemTodosDependentes = VerificarSeExisteTarefasDependentes($("#tarefasDependentes").val().split(","));

                if(!isTemTodosDependentes){
                    alert("Não e possível cadastrar a tarefa, pois não existe tarefa dependente correspondente a informada.");
                    return;
                }
            }

            codigo = novoCodigoTarefa;
            table.row.add([
                codigo,
                $("#nomeTarefa").val(),
                $("#tempoTarefa").val(),
                $("#tarefasDependentes").val(),
                "<button type=\"button\" class=\"btn btn-danger btn-floating\"><i class=\"fas fa-trash\"></i></button>"
            ]).draw();

            $("#nomeTarefa").val("");
            $("#tempoTarefa").val("");
            $("#tarefasDependentes").val("");
        }

        function VerificarDependentes(codigoTarefa) {
            var linhasTabela = table.rows().data();

            var resultado = false;

            $.each(linhasTabela, function (numeroLinha, conteudoLinha) {
                var arrTarefasDependentes = conteudoLinha[3].split(",");

                $.each(arrTarefasDependentes, function (indexDependente, identificadorTarefaDependente) {
                    if (parseInt(identificadorTarefaDependente) == parseInt(codigoTarefa)) {
                        resultado = true;
                    }
                });

            });

            return resultado;
        }

        function VerificarSeExisteTarefasDependentes(arrDependentes) {
            var linhasTabela = table.rows().data();

            var resultado = false;

            $.each(arrDependentes, function (nDependente, rDependente) {
                resultado = false;

                $.each(linhasTabela, function (nTabela, rTabela) {
                    if(parseInt(rTabela[0]) == parseInt(rDependente)){
                        resultado = true;
                    }
                });

                if (resultado == false) {
                    return false;
                }
            });

            return resultado;
        }
    </script>
</body>

</html>